<!-- KeepMoviEZ  v4.2.2-->
<!DOCTYPE html>
<html lang="en">
<!-- START CHUNK: Document Head and Core Dependencies -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>KeepMoviEZ</title>
    <link rel="icon" type="image/x-icon" href="favicon.png">
    <!-- Primary Meta Tags -->
  <title>KeepMoviEZ  - Smart Movie & Series Tracker | Log, Rate & Visualize</title>
  <meta name="title" content="KeepMoviEZ  - Smart Movie & Series Tracker | Log, Rate & Visualize">
  <meta name="description" content="KeepMoviEZ  is your personal smart movie and series tracking app. Created by Nishant Adhikari @  nishantadhikari.info.np">
  <meta name="keywords" content="KeepMoviEZ , movie tracker, TV tracker, watchlist manager, movie log app, film log, media tracker, movie history app, watch stats, TMDB log, personal movie diary, PWA movie app, Supabase media app, media collection, KMZLogger, MovizEZCloudTracker, KMZMediaStats">
  <meta name="robots" content="index, follow">
  <meta name="author" content="KeepMoviEZ  Team">
  <link rel="canonical" href="keepmoviez.nishantadhikari.info.np">

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <!-- PWA Manifest and Theme -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2C3E50"> <!-- Should match manifest.json theme_color -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <!-- Supabase JS Client V2 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
<!-- END CHUNK: Document Head and Core Dependencies -->
<body>
<!-- START CHUNK: Overlays -->
    <div id="loadingOverlay" class="loading-overlay">
        <i class="fas fa-spinner fa-spin fa-3x text-primary"></i>
        <p class="mt-3 text-white ">Loading...</p>
    </div>
    <div id="themeTransitionOverlay" class="theme-transition-overlay"></div>
<!-- END CHUNK: Overlays -->

<!-- START CHUNK: Authentication Form -->
    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <h4 id="authTitle" class="text-center mb-4">Welcome to KeepMoviEZ !</h4>
            <p id="authMessage" class="text-muted text-center mb-3">Please sign in or create an account to continue.</p>

            <div id="supabaseAuthForm">
                <div class="form-group">
                    <label for="supabaseEmail">Email</label>
                    <input type="email" id="supabaseEmail" class="form-control" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label for="supabasePassword">Password</label>
                    <input type="password" id="supabasePassword" class="form-control" placeholder="Your password" required>
                </div>
                <div id="authError" class="alert alert-danger mt-2" style="display:none;"></div>
                <button id="supabaseLoginBtn" class="btn btn-primary btn-block mt-3">Login</button>
                <button id="supabaseSignupBtn" class="btn btn-outline-info btn-block mt-2">Sign Up</button>
                
                <div class="text-center my-3 text-muted">OR</div>

                <button id="supabaseGoogleSignInBtn" class="btn btn-light btn-block border">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo" style="height: 18px; margin-right: 10px;">
                </button>
                
                <button id="supabasePasswordResetBtn" class="btn btn-link btn-block mt-2">Forgot Password?</button>
            </div>

            <div id="passwordSetupSection" style="display:none;">
                <h5 class="text-center mb-3">Set a New Password</h5>
                <p class="text-muted text-center small mb-3">You have been redirected from a password reset link. Please enter and confirm your new password.</p>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" class="form-control" placeholder="Enter new password" required>
                </div>
                 <div class="form-group">
                    <label for="confirmNewPassword">Confirm New Password</label>
                    <input type="password" id="confirmNewPassword" class="form-control" placeholder="Confirm new password" required>
                </div>
                <div id="passwordResetError" class="alert alert-danger mt-2" style="display:none;"></div>
                <button id="updatePasswordBtn" class="btn btn-primary btn-block mt-3">Update Password</button>
            </div>
        </div>
    </div>
<!-- END CHUNK: Authentication Form -->

<!-- START CHUNK: Off-Canvas Application Menu -->
    <div id="appMenuBackdrop" class="offcanvas-backdrop"></div>
    <div id="appMenu" class="offcanvas-menu shadow-lg">
        <div class="offcanvas-header d-flex justify-content-between align-items-center p-3 border-bottom">
            <h5 class="mb-0">KeepMoviEZ </h5>
            <button type="button" class="close" data-dismiss="offcanvas" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
        </div>
        <div class="offcanvas-body p-0">
            <div class="user-section p-3 border-bottom">
                <span id="menuLoggedInUserEmail" class="d-block mb-1 small text-muted">Not logged in</span>
                <span id="menuOnlineStatusIndicator" class="badge badge-pill badge-danger" title="Online Status">Offline</span>
            </div>
            <div class="list-group list-group-flush">
                <button id="menuThemeToggleBtn" class="list-group-item list-group-item-action d-flex align-items-center">
                    <i class="fas fa-sun mr-2"></i> Theme
                </button>
                <!-- NEW Import/Pull Button -->
                <button id="menuImportBtn" class="list-group-item list-group-item-action d-flex align-items-center">
                    <i class="fas fa-cloud-download-alt mr-2"></i> Import / Pull
                </button>
                <!-- NEW Export/Push Button -->
                <button id="menuExportBtn" class="list-group-item list-group-item-action d-flex align-items-center">
                    <i class="fas fa-cloud-upload-alt mr-2"></i> Export / Push
                </button>
                <!-- Standard Sync Button -->
                <button id="menuSyncDataBtn" class="list-group-item list-group-item-action d-flex align-items-center">
                    <i class="fas fa-sync-alt mr-2"></i> Sync with Cloud
                </button>
                <!-- Erase Data Button -->
                <button id="menuEraseDataBtn" class="list-group-item list-group-item-action d-flex align-items-center text-danger">
                    <i class="fas fa-eraser mr-2"></i> Erase Data
                </button>
            </div>
            <div class="mt-3 mb-2 px-3 small text-muted">Insights & Stats</div>
            <div class="list-group list-group-flush">
                <button class="list-group-item list-group-item-action d-flex align-items-center" data-toggle="modal" data-target="#dailyRecommendationModal" data-dismiss-menu="true">
                    <i class="fas fa-calendar-day mr-2"></i> Daily Recommendation
                </button>
                <button class="list-group-item list-group-item-action d-flex align-items-center" data-toggle="modal" data-target="#personalizedSuggestionsModal" data-dismiss-menu="true">
                    <i class="fas fa-magic mr-2"></i>Engine Suggestions
                </button>
                <button class="list-group-item list-group-item-action d-flex align-items-center" data-toggle="modal" data-target="#achievementsModal" data-dismiss-menu="true">
                    <i class="fas fa-trophy mr-2"></i> Achievements
                </button>
                <button class="list-group-item list-group-item-action d-flex align-items-center" data-toggle="modal" data-target="#chartsModal" data-dismiss-menu="true">
                    <i class="fas fa-chart-pie mr-2"></i> Visual Data
                </button>
                <button class="list-group-item list-group-item-action d-flex align-items-center" data-toggle="modal" data-target="#detailedStatsModal" data-dismiss-menu="true">
                    <i class="fas fa-table mr-2"></i>Stats
                </button>
            </div>
        </div>
        <div class="offcanvas-footer p-3 mt-auto border-top">
            <button id="menuSupabaseLogoutBtn" class="btn btn-outline-warning btn-block"><i class="fas fa-sign-in-alt"></i> </button>
        </div>
    </div>
<!-- END CHUNK: Off-Canvas Application Menu -->

<!-- START CHUNK: Import / Pull -->
    <div class="modal fade" id="importModal" tabindex="-1" role="dialog" aria-labelledby="importModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importModalLabel">Import / Pull Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <h6>Force Pull from Cloud</h6>
                    <p class="small text-muted">This will erase all local data on this device and replace it with your data from the cloud. This is useful for syncing a new device or resolving major data conflicts.</p>
                    <button class="btn btn-warning btn-block" id="forcePullTriggerBtn"><i class="fas fa-cloud-download-alt"></i> Force Pull from Cloud</button>
                    <hr>
                    <h6>Import from File</h6>
                    <p class="small text-muted">Upload a CSV or JSON file to add or update your collection. You will be guided by the Smart Import Assistant.</p>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="menuCsvFileUploader" accept=".csv,.json">
                        <label class="custom-file-label" for="menuCsvFileUploader">Choose CSV/JSON file...</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Import / Pull -->

<!-- START CHUNK: Export / Push -->
    <div class="modal fade" id="exportModal" tabindex="-1" role="dialog" aria-labelledby="exportModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exportModalLabel">Export / Push Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <h6>Force Push to Cloud</h6>
                    <p class="small text-danger"><strong>Warning:</strong> This will completely overwrite your cloud data with the data from this device. Any changes made on other devices since your last sync will be lost.</p>
                    <button class="btn btn-danger btn-block" id="forcePushTriggerBtn"><i class="fas fa-cloud-upload-alt"></i> Force Push to Cloud</button>
                    <hr>
                    <h6>Export as File</h6>
                    <p class="small text-muted">Download a local backup of your collection in either CSV or JSON format.</p>
                    <div class="d-flex justify-content-around">
                        <button class="btn btn-primary" id="exportCsvBtn"><i class="fas fa-file-csv"></i> Download CSV</button>
                        <button class="btn btn-info" id="exportJsonBtn"><i class="fas fa-file-code"></i> Download JSON</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Export / Push -->

<!-- START CHUNK: Confirm Force Pull -->
    <div class="modal fade" id="confirmForcePullModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">Confirm Force Pull</h5>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure? This will **permanently delete** all local data on this device and replace it with your current cloud backup. This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" id="confirmForcePullBtn">Yes, Pull from Cloud</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Confirm Force Pull -->

<!-- START CHUNK: Confirm Force Push -->
    <div class="modal fade" id="confirmForcePushModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Confirm Force Push</h5>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p><strong>DANGER:</strong> Are you absolutely sure? This will **permanently overwrite** your entire cloud backup with the data currently on this device. Any entries or changes on other devices will be lost forever.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmForcePushBtn">Yes, Overwrite Cloud</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Confirm Force Push -->

<!-- START CHUNK: Main App Layout & Top Navigation Bar -->
    <div id="appContent" style="display: none;">
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
            <button class="navbar-toggler mr-2" type="button" data-toggle="offcanvas" data-target="#appMenu" aria-controls="appMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a id="Brand" class="navbar-brand" href="#"><strong id="fthis">KeepMoviEZ </strong></a>
            
            <div class="ml-auto d-flex align-items-center">
                <form id="navbarSearchForm" class="form-inline my-2 my-lg-0 mr-2">
                    <div class="input-group">
                        <input type="text" id="filterInputNavbar" class="form-control form-control-sm" placeholder="Search..." aria-label="Search Collection">
                        <div class="input-group-append">                    
                            <button id="clearSearchBtn" class="btn btn-sm btn-outline-secondary" type="button" style="display:none;" title="Clear Search"><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                </form>
                <button id="filterBtn" class="btn btn-sm btn-outline-info" data-toggle="modal" data-target="#filterSortModal" title="Filter and Sort">
                    <i class="fas fa-filter"></i>
                </button>
            </div>
        </nav>
<!-- END CHUNK: Main App Layout & Top Navigation Bar -->

<!-- START CHUNK: Main Content Display Area -->
        <div class="container-fluid mt-4">
            <div id="initialMessage" class="initial-upload-section text-center p-4 rounded shadow-sm">
                <h4>Welcome to KeepMoviEZ !</h4>
                <p>Your movie log is currently empty. Add your first entry using the '+' button below, or upload an existing collection using the "CSV/JSON" button in the menu.</p>
                <p class="text-info small mt-3"><strong>Tip:</strong>
                    You can find a demo CSV file here: <a href="https://drive.google.com/file/d/1Q_qiQuJfY030fOUcv2tdezAh4qPUgZPh/view?usp=drivesdk" target="_blank" rel="noopener noreferrer">Demo CSV</a>.
                </p>
            </div>
            
            <div class="table-responsive" tabindex="0">
                <div id="movieCardContainer" class="card-container">
                    <!-- Movie cards will be dynamically injected here -->
                </div>
            </div>
        </div>
<!-- END CHUNK: Main Content Display Area -->

<!-- START CHUNK: Bottom Navigation & Action Bar -->
        <nav id="bottomNav" class="navbar fixed-bottom-nav center-add-btn">
            <div id="multiSelectActionsBar" class="multi-select-actions-bar" style="display: none;">
                <button id="batchEditSelectedBtn" class="btn btn-info"><i class="fas fa-edit"></i> Edit Selected</button>
                <button id="batchDeleteSelectedBtn" class="btn btn-danger"><i class="fas fa-trash-alt"></i> Delete Selected</button>
                <button id="cancelMultiSelectBtn" class="btn btn-secondary"><i class="fas fa-times"></i> Cancel</button>
                <span id="multiSelectCount" class="text-white ml-2 small">0 selected</span>
            </div>
            <button id="addNewEntryBtn" class="btn btn-primary" data-toggle="modal" data-target="#entryModal"> <i class="fas fa-plus-circle"></i> </button>
        </nav>
    </div> <!-- This closes #appContent -->
<!-- END CHUNK: Bottom Navigation & Action Bar -->

<!-- START CHUNK: Modal - Filter & Sort -->
    <div class="modal fade" id="filterSortModal" tabindex="-1" role="dialog" aria-labelledby="filterSortModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="filterSortModalLabel">Sort & Filter</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
                </div>
                <div class="modal-body">
                    <form id="filterSortForm">
                        <div class="filter-modal-section">
                            <h6>Sort Options</h6>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="sortColumn">Sort By</label>
                                    <select id="sortColumn" class="form-control form-control-sm">
                                        <option value="Name">Name</option>
                                        <option value="lastModifiedDate">Last Modified</option>
                                        <option value="LastWatchedDate">Last Watched</option>
                                        <option value="Year">Year</option>
                                        <option value="overallRating">Rating</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="sortDirection">Direction</label>
                                    <select id="sortDirection" class="form-control form-control-sm">
                                        <option value="asc">Ascending</option>
                                        <option value="desc">Descending</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="filter-modal-section">
                            <h6>Filter Options</h6>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="filterCategory">Category</label>
                                    <select id="filterCategory" class="form-control form-control-sm"></select>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="filterCountry">Country</label>
                                    <select id="filterCountry" class="form-control form-control-sm"></select>
                                </div>
                            </div>
                             <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="filterLanguage">Language</label>
                                    <select id="filterLanguage" class="form-control form-control-sm"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="filterGenreSearchInput">Filter by Genres</label>
                                <div class="d-flex justify-content-start align-items-center mb-2">
                                    <small class="mr-2">Match:</small>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="filterGenreLogic" id="filterGenreLogicAnd" value="AND" checked>
                                        <label class="form-check-label small" for="filterGenreLogicAnd">All</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="filterGenreLogic" id="filterGenreLogicOr" value="OR">
                                        <label class="form-check-label small" for="filterGenreLogicOr">Any</label>
                                    </div>
                                </div>
                                <div id="filterGenreContainer" aria-label="Selected genres and add control" tabindex="0">
                                    <input id="filterGenreSearchInput" type="text" placeholder="Click to add genres..." aria-label="Search or add genres to filter by">
                                </div>
                                <div id="filterGenreDropdown">
                                    <div id="filterGenreItemsContainer" class="list-group mt-1"></div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="clearFiltersBtn">Clear Filters</button>
                    <button type="button" class="btn btn-primary" id="applyFiltersBtn">Apply</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Filter & Sort -->

<!-- START CHUNK: Modal - Smart Import -->
    <div class="modal fade" id="smartImportModal" tabindex="-1" role="dialog" aria-labelledby="smartImportModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="smartImportModalLabel">Smart Import Assistant</h5>
                </div>
                <div class="modal-body">
                    <div id="importSummary">
                        <p>Analyzing your file... <i class="fas fa-spinner fa-spin"></i></p>
                    </div>
                    <hr>
                    <h6>Choose Your Import Strategy:</h6>
                    <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="importStrategy" id="strategyAppendNew" value="append_new" checked>
                            <label class="form-check-label" for="strategyAppendNew">
                                <strong>Append New Entries Only</strong> (Safest)
                                <small class="d-block text-muted">Only adds titles that are not found in your library. Ignores all potential matches and duplicates.</small>
                            </label>
                        </div>

                        <!-- ## NEWLY ADDED SECTION START ## -->
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="radio" name="importStrategy" id="strategyBackfill" value="backfill_missing">
                            <label class="form-check-label" for="strategyBackfill">
                                <strong>Smart Backfill Missing Data</strong> (Recommended for Recovery)
                                <small class="d-block text-muted">Adds new entries and for existing entries, it ONLY fills in fields that are currently empty (like runtime, related entries etc.). It will not overwrite any existing data.</small>
                            </label>
                        </div>
                        <!-- ## NEWLY ADDED SECTION END ## -->

                        <div class="form-check mt-2">
                            <input class="form-check-input" type="radio" name="importStrategy" id="strategyUpdate" value="update_matches">
                            <label class="form-check-label" for="strategyUpdate">
                                <strong>Append New & Update Matches</strong>
                                <small class="d-block text-muted">Adds new titles and updates existing entries if the imported version is newer (based on `lastModifiedDate`).</small>
                            </label>
                        </div>
                         <div class="form-check mt-2">
                            <input class="form-check-input" type="radio" name="importStrategy" id="strategyOverwrite" value="overwrite_all">
                            <label class="form-check-label" for="strategyOverwrite">
                                <strong>Overwrite All Matches</strong> (Advanced)
                                <small class="d-block text-danger">For every match found, the version from the file will completely replace your existing data for that entry.</small>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cancelImportBtn">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmImportBtn">Process Import</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Smart Import -->

<!-- START CHUNK: Modal - Entry Form (Add/Edit) -->
    <div class="modal fade" id="entryModal" tabindex="-1" role="dialog" aria-labelledby="entryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="entryModalLabel">Add New Entry</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">X</span> </button>
                </div>
                <div class="modal-body">
                    <form id="entryForm" novalidate>
                        <!-- Hidden fields remain at the top for easy access by JS -->
                        <input type="hidden" id="editEntryId"> <input type="hidden" id="posterUrl">
                        <input type="hidden" id="tmdbId"> <input type="hidden" id="tmdbMediaType">
                        <input type="hidden" id="currentWatchHistory" value="[]"> <input type="hidden" id="editingWatchId">

                        <div class="accordion entry-form-accordion" id="entryFormAccordion">

                            <!-- SECTION 1: PRIMARY INFO & TMDB SEARCH -->
                            <div class="card">
                                <div class="card-header" id="primaryInfoHeading">
                                    <h5 class="mb-0">
                                        <button type="button" class="btn btn-link" data-toggle="collapse" data-target="#primaryInfoCollapse" aria-expanded="true" aria-controls="primaryInfoCollapse">
                                            Info
                                        </button>
                                    </h5>
                                </div>
                                <div id="primaryInfoCollapse" class="collapse show" aria-labelledby="primaryInfoHeading" data-parent="#entryFormAccordion">
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label for="movieName">Name</label>
                                            <input type="text" class="form-control" id="movieName" required placeholder="e.g., The Matrix">
                                        </div>
                                        <div class="form-group">
                                            <label>Search</label>
                                            <div class="input-group">
                                                <input type="number" class="form-control tmdb-year-input" id="tmdbSearchYear" placeholder="Year (Optional)" min="1888" max="2100">
                                                <div class="input-group-append"><button type="button" class="btn btn-info" id="searchTmdbBtn"><i class="fas fa-search"></i> Search & Autofill</button></div>
                                            </div>
                                        </div>
                                        <div id="tmdbSearchResults" class="list-group mb-3" style="max-height: 200px; overflow-y: auto; display: none;"></div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6"><label for="category">Category</label><select id="category" class="form-control"><option value="Movie">Movie</option><option value="Series">Series</option><option value="Documentary">Documentary</option><option value="Special">Special</option></select></div>
                                            <div class="form-group col-md-6"><label for="status">Status</label><select id="status" class="form-control"><option value="To Watch">To Watch</option><option value="Watched">Watched</option><option value="Continue">Continue</option><option value="Unwatched">Unwatched</option></select></div>
                                        </div>
                                        <div id="seriesContinueGroup" class="form-row" style="display: none;">
                                            <div class="form-group col-6"><label for="seasonsCompleted">Seasons Done</label><input type="number" class="form-control form-control-sm" id="seasonsCompleted" min="0"></div>
                                            <div class="form-group col-6"><label for="currentSeasonEpisodesWatched">Current S. Episodes</label><input type="number" class="form-control form-control-sm" id="currentSeasonEpisodesWatched" min="0"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SECTION 2: MY RATINGS & WATCH HISTORY -->
                            <div class="card">
                                <div class="card-header" id="ratingsHeading">
                                    <h5 class="mb-0">
                                        <button type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#ratingsCollapse" aria-expanded="false" aria-controls="ratingsCollapse">
                                            Ratings & History
                                        </button>
                                    </h5>
                                </div>
                                <div id="ratingsCollapse" class="collapse" aria-labelledby="ratingsHeading" data-parent="#entryFormAccordion">
                                    <div class="card-body">
                                        <div class="form-row">
                                            <div class="form-group col-md-6" id="overallRatingGroup" style="display: none;"><label for="overallRating">My Overall Rating</label><select id="overallRating" class="form-control"><option value="">--Select--</option><option value="1">1 Star</option><option value="2">2 Stars</option><option value="3">3 Stars</option><option value="4">4 Stars</option><option value="5">5 Stars</option></select></div>
                                            <div class="form-group col-md-6" id="recommendationGroup" style="display: none;"><label for="recommendation">My Recommendation</label><select id="recommendation" class="form-control"><option value="">-Select-</option><option value="Ignore">Ignore</option><option value="Less Recommended">Less Recommended</option><option value="Recommended">Recommended</option><option value="Highly Recommended">Highly Recommended</option></select></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="personalRecommendation">Watch Preference</label><select id="personalRecommendation" class="form-control"><option value="">--Select--</option><option value="Watch Alone">Watch Alone</option><option value="Safe to share">Safe to Share</option></select>
                                        </div>
                                        <hr>
                                        <div id="watchHistorySection">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <h6>Watch Records</h6>
                                                <button type="button" class="btn btn-sm btn-outline-primary" id="toggleAddWatchInstanceFormBtn"><i class="fas fa-plus"></i> Add Record</button>
                                            </div>
                                            <div id="addWatchInstanceForm" class="p-3 border rounded mb-3" style="display:none;">
                                                <h6 id="watchInstanceFormTitle" class="mb-3">Add Watch Record</h6>
                                                <div class="form-row">
                                                    <div class="form-group col-md-6"><label for="watchDate">Date</label><input type="date" class="form-control" id="watchDate"></div>
                                                    <div class="form-group col-md-6"><label for="watchRating">Rating</label><select id="watchRating" class="form-control"><option value="">--Select--</option><option value="1">1 Star</option><option value="2">2 Stars</option><option value="3">3 Stars</option><option value="4">4 Stars</option><option value="5">5 Stars</option></select></div>
                                                </div>
                                                <div class="form-group"><label for="watchNotes">Notes</label><textarea class="form-control" id="watchNotes" rows="2"></textarea></div>
                                                <button type="button" class="btn btn-success btn-sm mr-2" id="saveWatchInstanceBtn">Save</button><button type="button" class="btn btn-secondary btn-sm" id="cancelWatchInstanceBtn">Cancel</button>
                                            </div>
                                            <div id="watchHistoryList"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- SECTION 3: DETAILS & CLASSIFICATION -->
                            <div class="card">
                                <div class="card-header" id="detailsHeading">
                                    <h5 class="mb-0">
                                        <button type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#detailsCollapse" aria-expanded="false" aria-controls="detailsCollapse">
                                            Details 
                                        </button>
                                    </h5>
                                </div>
                                <div id="detailsCollapse" class="collapse" aria-labelledby="detailsHeading" data-parent="#entryFormAccordion">
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label for="genreSearchInput">Genre</label>
                                            <div id="genreInputContainer" tabindex="0"><input id="genreSearchInput" type="text" placeholder="Click to add genres..."></div>
                                            <div id="genreDropdown"><div id="genreItemsContainer" class="list-group mt-1"></div></div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-4"><label for="year">Year</label><input type="number" class="form-control" id="year" min="1888" max="2100"></div>
                                            <div class="form-group col-md-4"><label for="language">Language</label><input type="text" class="form-control" id="language"></div>
                                            <div class="form-group col-md-4"><label for="country">Country</label><input type="text" class="form-control" id="country" placeholder="e.g., US, IN"></div>
                                        </div>
                                        <div id="runtimeSection">
                                            <div id="movieRuntimeGroup" class="form-group" style="display: none;"><label for="runtimeMovie">Runtime (minutes)</label><input type="number" class="form-control" id="runtimeMovie" min="0"></div>
                                            <div id="seriesRuntimeGroup" class="form-row" style="display: none;">
                                                <div class="form-group col-md-4"><label for="runtimeSeriesSeasons">Total Seasons</label><input type="number" class="form-control" id="runtimeSeriesSeasons" min="0"></div>
                                                <div class="form-group col-md-4"><label for="runtimeSeriesEpisodes">Total Episodes</label><input type="number" class="form-control" id="runtimeSeriesEpisodes" min="0"></div>
                                                <div class="form-group col-md-4"><label for="runtimeSeriesAvgEp">Avg. Ep. (min)</label><input type="number" class="form-control" id="runtimeSeriesAvgEp" min="0"></div>
                                            </div>
                                        </div>
                                        <div class="form-group"><label for="description">Description</label><textarea class="form-control" id="description" rows="3"></textarea></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- SECTION 4: Related-->
                            <div class="card">
                                <div class="card-header" id="advancedHeading">
                                    <h5 class="mb-0">
                                        <button type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#advancedCollapse" aria-expanded="false" aria-controls="advancedCollapse">
                                             Related
                                        </button>
                                    </h5>
                                </div>
                                <div id="advancedCollapse" class="collapse" aria-labelledby="advancedHeading" data-parent="#entryFormAccordion">
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label for="relatedEntriesNames">Link to Other Entries in Your Log</label>
                                            <input type="text" class="form-control" id="relatedEntriesNames" placeholder="Start typing a title...">
                                            <div id="relatedEntriesSuggestions" class="list-group mt-1" style="display: none; max-height: 150px; overflow-y: auto;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" form="entryForm" class="btn btn-primary"><i class="fas fa-save"></i> Save Entry</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Entry Form (Add/Edit) -->

<!-- START CHUNK: Modal - Details View -->
    <div class="modal fade" id="detailsModal" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailsModalLabel">Entry Details</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-3 text-center mb-3 mb-md-0">
                            <img id="detailsPoster" alt="Movie Poster" class="tmdb-details-poster d-none img-fluid">
                            <div id="noPosterMessage" class="text-muted small mt-2">No Poster Available</div>
                        </div>
                        <div class="col-md-9">
                            <h4 id="detailsName" class="mb-3"></h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Category:</strong> <span id="detailsCategory"></span></p>
                                    <p><strong>Genre:</strong> <span id="detailsGenre"></span></p>
                                    <p><strong>Status:</strong> <span id="detailsStatus"></span></p>                                    
                                    <p id="detailsContinueGroup" style="display:none;"><strong>Progress:</strong> <span id="detailsContinue"></span></p>
                                    <p id="detailsRuntimeGroup" style="display:none;"><strong>Runtime:</strong> <span id="detailsRuntime"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <p id="detailsRecommendationGroup" style="display:none;"><strong>My Recommendation:</strong> <span id="detailsRecommendation"></span></p>
                                    <p id="detailsOverallRatingGroup" style="display:none;"><strong>My Overall Rating:</strong> <span id="detailsOverallRating"></span></p>
                                    <p id="detailsPersonalRecommendationGroup" style="display:none;"><strong>Watch Preference:</strong> <span id="detailsPersonalRecommendation"></span></p>
                                    <p><strong>Language:</strong> <span id="detailsLanguage"></span></p>
                                    <p><strong>Year:</strong> <span id="detailsYear"></span></p>
                                    <p><strong>Country:</strong> <span id="detailsCountry"></span></p>
                                     <p id="detailsTMDBRatingGroup" style="display:none;"><strong>TMDB Rating:</strong> <span id="detailsTMDBRating"></span></p>
                                </div>
                            </div>
                            <p class="mt-2"><strong>Description:</strong> <span id="detailsDescription"></span></p>
                             <p class="mt-2"><strong>Keywords:</strong> <span id="detailsKeywords" class="text-muted small">N/A</span></p>
                            <p class="mt-2"><strong>Last Modified:</strong> <span id="detailsLastModified" class="text-muted small"></span></p>
                        </div>
                    </div>

                    <hr>
                    <div id="detailsCastCrewSection" class="mt-3" style="display:none;">
                        <h5>Cast & Crew</h5>
                        <p><strong>Director:</strong> <span id="detailsDirector" class="person-link">N/A</span></p>
                        <h6>Main Cast:</h6>
                        <div id="detailsCastList" class="row person-list"></div>
                    </div>
                    <hr id="castCrewSeparator" style="display:none;">
                    <div id="detailsManualLinksGroup" class="related-group mt-3" style.display:none;">
                        <h5>Related</h5>
                        <ul id="detailsManualLinksList" class="list-unstyled related-list"></ul>
                    </div>
                    
                    <hr id="manualLinksSeparator" style="display:none;"> 
                    <div id="detailsEnhancedRelatedSection" class="mt-3" style="display:none;">
                        <h5>Contextual Links</h5>
                        <div id="detailsFranchiseGroup" class="related-group" style="display:none;">
                            <h6>Part of Franchise/Collection: <span id="detailsFranchiseName" class="text-info"></span></h6>
                            <ul id="detailsFranchiseList" class="list-unstyled related-list"></ul>
                        </div>
                        <div id="detailsDirectorGroup" class="related-group mt-2" style="display:none;">
                            <h6>More by Director <span id="detailsSameDirectorName" class="text-info"></span>:</h6>
                            <ul id="detailsSameDirectorList" class="list-unstyled related-list"></ul>
                        </div>
                        <div id="detailsStudioGroup" class="related-group mt-2" style="display:none;">
                            <h6>More by Studio: <span id="detailsStudioName" class="text-info"></span></h6>
                            <ul id="detailsStudioList" class="list-unstyled related-list"></ul>
                        </div>
                    </div>
                    
                     <hr id="enhancedRelatedSeparator" style="display:none;">

                    <div id="detailsWatchHistorySection" class="details-watch-history mt-3" style="display:none;">
                        <h5>Watch History</h5>
                        <ul id="detailsWatchHistoryList" class="list-unstyled"></ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="detailsModalAddBtn" style="display:none;"><i class="fas fa-plus-circle"></i> Add to 'To Watch' List</button>
                    <button type="button" class="btn btn-info" id="findSimilarBtn" style="display:none;"><i class="fas fa-magic"></i> Find Similar</button>
                    <button type="button" class="btn btn-success" id="downloadDetailsImageBtn"><i class="fas fa-download"></i>Get PNG</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Details View -->

<!-- START CHUNK: Modal - Person Details -->
    <div class="modal fade" id="personDetailsModal" tabindex="-1" role="dialog" aria-labelledby="personDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="personDetailsModalLabel"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
                </div>
                <div class="modal-body text-center">
                    <img id="personProfileImage" alt="Person Profile" class="person-profile-img img-fluid d-none">
                    <p id="noPersonImageMessage" class="text-muted small mt-2">No Image Available</p>
                    <p id="personBio" class="mt-3 text-left small"></p>

                    <hr>
                    <h5>Filmography in Your Log</h5>
                    <ul id="personFilmographyList" class="list-unstyled text-left"></ul>
                </div>
                <div class="modal-footer">
                     <button type="button" class="btn btn-info" id="viewTmdbPersonBtn" target="_blank" rel="noopener noreferrer" style="display:none;"><i class="fas fa-external-link-alt"></i> View on TMDB</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Person Details -->

<!-- START CHUNK: Modal - Detailed Statistics -->
    <div class="modal fade" id="detailedStatsModal" tabindex="-1" role="dialog" aria-labelledby="detailedStatsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailedStatsModalLabel">Detailed Statistics</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                    <ul class="nav nav-tabs mb-3" id="detailedStatsTab" role="tablist">
                        <li class="nav-item"> <a class="nav-link active" id="summary-detailed-tab" data-toggle="tab" href="#stats-summary-detailed" role="tab" aria-controls="stats-summary-detailed" aria-selected="true">Summary</a> </li>
                        <li class="nav-item"> <a class="nav-link" id="progress-detailed-tab" data-toggle="tab" href="#stats-progress-detailed" role="tab" aria-controls="stats-progress-detailed" aria-selected="false">Progress</a> </li>
                        <li class="nav-item"> <a class="nav-link" id="temporal-detailed-tab" data-toggle="tab" href="#stats-temporal-detailed" role="tab" aria-controls="stats-temporal-detailed" aria-selected="false">Time Analysis</a> </li>
                        <li class="nav-item"> <a class="nav-link" id="genre-deep-dive-detailed-tab" data-toggle="tab" href="#stats-genre-deep-dive-detailed" role="tab" aria-controls="stats-genre-deep-dive-detailed" aria-selected="false">Genre Deep Dive</a> </li>
                        <li class="nav-item"> <a class="nav-link" id="ratings-deep-dive-detailed-tab" data-toggle="tab" href="#stats-ratings-deep-dive-detailed" role="tab" aria-controls="stats-ratings-deep-dive-detailed" aria-selected="false">Rating Insights</a> </li>
                        <li class="nav-item"> <a class="nav-link" id="people-production-detailed-tab" data-toggle="tab" href="#stats-people-production-detailed" role="tab" aria-controls="stats-people-production-detailed" aria-selected="false">People & Production</a> </li>
                        <li class="nav-item"> <a class="nav-link" id="geo-lang-detailed-tab" data-toggle="tab" href="#stats-geo-lang-detailed" role="tab" aria-controls="stats-geo-lang-detailed" aria-selected="false">Country & Language</a> </li>
                    </ul>
                    <div class="tab-content" id="detailedStatsTabContent">
                        <div class="tab-pane fade show active" id="stats-summary-detailed" role="tabpanel" aria-labelledby="summary-detailed-tab">
                            <div class="row">
                                <div class="col-md-6 stats-section">
                                    <h6>Overall Summary</h6>
                                    <p><strong>Total Entries:</strong> <span id="statsTotalEntries">0</span></p>
                                    <p><strong>Total Titles Watched:</strong> <span id="statsTotalTitlesWatched">0</span></p>
                                    <p><strong>Total Watch Instances:</strong> <span id="statsTotalWatchInstances">0</span></p>
                                    <p><strong>Total Watch Time (Est.):</strong> <span id="statsTotalWatchTime">N/A</span></p>
                                    <p><strong>Average Overall Rating: </strong> <span id="statsAvgOverallRating">N/A</span></p>
                                </div>
                                <div class="col-md-6 stats-section">
                                    <h6>Entries by Category</h6>
                                    <ul id="statsByCategory" class="list-group list-group-flush"></ul>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 stats-section">
                                    <h6>Entries by Status</h6>
                                    <ul id="statsByStatus" class="list-group list-group-flush"></ul>
                                </div>
                                <div class="col-md-6 stats-section">
                                    <h6>Top 5 Rated Genres (Overall)</h6>
                                    <ol id="statsTopRatedGenresOverall" class="list-group list-group-flush"></ol>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="stats-progress-detailed" role="tabpanel" aria-labelledby="progress-detailed-tab">
                             <div class="stats-section">
                                <h6>Your Watchlist Progress</h6>
                                <p><strong>"To Watch" List Progress:</strong> <span id="statsToWatchCompletion">0%</span></p>
                                <div class="progress">
                                    <div id="toWatchProgressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <p class="mt-2"><strong>Watched:</strong> <span id="watchedCountProgress">0</span> / <span id="totalRelevantCountProgress">0</span></p>
                                <hr>
                                <h6>Pace & Predictions</h6>
                                <p><strong>Estimated time to finish 'To Watch' list:</strong> <span id="estimatedCompletionTime">N/A</span></p>
                                <p><strong>Completion Prediction (30-day pace):</strong> <span id="completionPrediction30">N/A</span></p>
                                <p><strong>Completion Prediction (90-day pace):</strong> <span id="completionPrediction90">N/A</span></p>
                                <p><strong>Completion Prediction (365-day pace):</strong> <span id="completionPrediction365">N/A</span></p>
                                <hr>
                                <h6>Watchlist Growth (Last 30 Days)</h6>
                                <p><strong>Net Change:</strong> <span id="watchlistGrowth30">N/A</span></p>
                                <div class="stats-chart-container" style="height: 250px;">
                                    <canvas id="chartWatchlistGrowth"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="stats-temporal-detailed" role="tabpanel" aria-labelledby="temporal-detailed-tab">
                            <div class="stats-section">
                                <h6>Watch Activity by Year</h6>
                                <p class="small text-muted">Based on individual watch instance dates.</p>
                                <div id="statsWatchesByYear" class="table-responsive" style="max-height: 300px;">
                                    <table class="table table-sm table-bordered">
                                        <thead><tr><th>Year</th><th>Watch Instances</th><th>Unique Titles Watched</th><th>Avg. Rating This Year</th></tr></thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="stats-section mt-4">
                                <h6>Recent Monthly Watch Activity</h6>
                                <p class="small text-muted">Based on individual watch instance dates.</p>
                                <div id="statsWatchesByMonth" class="table-responsive" style="max-height: 300px;">
                                    <table class="table table-sm table-bordered">
                                        <thead><tr><th>Month</th><th>Watch Instances</th><th>Unique Titles Watched</th></tr></thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="stats-genre-deep-dive-detailed" role="tabpanel" aria-labelledby="genre-deep-dive-detailed-tab">
                            <div class="row">
                                <div class="col-md-6 stats-section"><h6>Most Frequent Single Genres</h6><ol id="statsTopSingleGenres" class="list-group list-group-flush" style="max-height: 250px; overflow-y:auto;"></ol></div>
                                <div class="col-md-6 stats-section"><h6>Top 10 Average Rated Genres</h6><ol id="statsAvgRatingByGenre" class="list-group list-group-flush" style="max-height: 250px; overflow-y:auto;"></ol></div>
                            </div>
                            <div class="stats-section mt-3"><h6>Most Frequent Genre Combinations</h6><p class="small text-muted">Considers exact combinations.</p><ol id="statsGenreCombinations" class="list-group list-group-flush"></ol></div>
                        </div>
                        <div class="tab-pane fade" id="stats-ratings-deep-dive-detailed" role="tabpanel" aria-labelledby="ratings-deep-dive-detailed-tab">
                            <div class="row">
                                <div class="col-md-6 stats-section"><h6>Distribution of Overall Entry Ratings</h6><ul id="statsByOverallRating" class="list-group list-group-flush"></ul></div>
                                <div class="col-md-6 stats-section"><h6>Distribution of Individual Watch Ratings</h6><ul id="statsByWatchInstanceRating" class="list-group list-group-flush"></ul></div>
                            </div>
                            <div class="stats-section mt-3"><h6>Average Overall Rating by Category</h6><ul id="statsAvgOverallRatingByCategory" class="list-group list-group-flush"></ul></div>
                        </div>
                        <div class="tab-pane fade" id="stats-people-production-detailed" role="tabpanel" aria-labelledby="people-production-detailed-tab">
                            <div class="row">
                                <div class="col-md-6 stats-section">
                                    <h6>Most Watched Actors (Top 10)</h6>
                                    <ol id="statsMostWatchedActors" class="list-group list-group-flush" style="max-height: 300px; overflow-y:auto;"></ol>
                                </div>
                                <div class="col-md-6 stats-section">
                                    <h6>Most Watched Directors (Top 10)</h6>
                                    <ol id="statsMostWatchedDirectors" class="list-group list-group-flush" style="max-height: 300px; overflow-y:auto;"></ol>
                                </div>
                            </div>
                             <div class="stats-section mt-3">
                                <h6>Most Frequent Production Companies (Top 10)</h6>
                                <ol id="statsMostFrequentProductionCompanies" class="list-group list-group-flush" style="max-height: 300px; overflow-y:auto;"></ol>
                            </div>
                            <div class="stats-section mt-3"><h6>Average Overall Rating by Studio (Top 5)</h6><ul id="statsAvgRatingByStudio" class="list-group list-group-flush"></ul></div>
                        </div>
                        <div class="tab-pane fade" id="stats-geo-lang-detailed" role="tabpanel" aria-labelledby="geo-lang-detailed-tab">
                            <div class="row">
                                <div class="col-md-6 stats-section"><h6>Top Countries of Origin</h6><ol id="statsTopCountries" class="list-group list-group-flush" style="max-height: 250px; overflow-y:auto;"></ol></div>
                                <div class="col-md-6 stats-section"><h6>Top Original Languages</h6><ol id="statsTopLanguages" class="list-group list-group-flush" style="max-height: 250px; overflow-y:auto;"></ol></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                  <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="timeFormatToggle">
                     <label class="custom-control-label small" for="timeFormatToggle"></label>
                    </div>
                    <div>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="exportStatsPdfBtn"><i class="fas fa-file-pdf"></i> Export as PDF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Detailed Statistics -->

<!-- START CHUNK: Modal - Daily Recommendation -->
    <div class="modal fade" id="dailyRecommendationModal" tabindex="-1" role="dialog" aria-labelledby="dailyRecommendationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="dailyRecommendationModalLabel">Daily Recommendation</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
                </div>
                <div class="modal-body" id="dailyRecommendationModalBody">
                    <p class="text-center text-muted p-3">Loading daily recommendation...</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Daily Recommendation -->

<!-- START CHUNK: Modal - Personalized Suggestions -->
    <div class="modal fade" id="personalizedSuggestionsModal" tabindex="-1" role="dialog" aria-labelledby="personalizedSuggestionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="personalizedSuggestionsModalLabel">Engine Suggestions</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
                </div>
                <div class="modal-body" id="personalizedSuggestionsModalBody">
                     <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 id="recommendationsListTitleModal">Your Suggestions</h6>
                        <button id="refreshRecommendationsBtnModal" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <p class="text-muted small">Based on your data and preferences.</p>
                    <div id="recommendationsListModal" class="list-group">
                        <p class="text-center text-muted p-3">Loading suggestions...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Personalized Suggestions -->

<!-- START CHUNK: Modal - Achievements -->
    <div class="modal fade" id="achievementsModal" tabindex="-1" role="dialog" aria-labelledby="achievementsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="achievementsModalLabel">Achievements</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
                </div>
                <div class="modal-body" id="achievementsModalBody" style="max-height: 70vh; overflow-y: auto;">
                    <div id="achievementBadgesModal" class="d-flex flex-wrap justify-content-center">
                        <p class="text-center text-muted p-3">Loading achievements...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Achievements -->

<!-- START CHUNK: Modal - Visual Data (Charts) -->
    <div class="modal fade" id="chartsModal" tabindex="-1" role="dialog" aria-labelledby="chartsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="chartsModalLabel">Visual Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
                </div>
                <div class="modal-body row" id="chartsModalBody" style="max-height: 80vh; overflow-y: auto;">
                    <div class="col-md-6 stats-chart-container"><h6>Watch Instances by Year</h6><canvas id="chartModalWatchInstancesByYear"></canvas></div>
                    <div class="col-lg-12 stats-chart-container"><h6>Pace Comparison (30, 90, 365 Days)</h6><canvas id="chartNormalizedPace"></canvas></div>
                    <div class="col-md-6 stats-chart-container"><h6>Entries Watched per Genre</h6><canvas id="chartModalMoviesPerGenre"></canvas></div>
                    <div class="col-md-6 stats-chart-container"><h6>Overall Entry Rating Distribution</h6><canvas id="chartModalOverallRatingDistribution"></canvas></div>
                    <div class="col-md-6 stats-chart-container"><h6>Individual Watch Rating Distribution</h6><canvas id="chartModalWatchInstanceRatingDistribution"></canvas></div>
                    <div class="col-md-6 stats-chart-container"><h6>Entry Status Breakdown</h6><canvas id="chartModalMovieStatusBreakdown"></canvas></div>
                    <div class="col-md-6 stats-chart-container"><h6>Language Distribution</h6><canvas id="chartModalLanguageDistribution"></canvas></div>
                    <div class="col-md-6 stats-chart-container"><h6>Top 10 Country Distributions</h6><canvas id="chartModalCountryDistribution"></canvas></div>
                    <div class="col-md-6 stats-chart-container"><h6>Monthly Watch Activity</h6><canvas id="chartModalWatchActivityOverTime"></canvas></div>
                   <!-- <div class="col-md-6 stats-chart-container"><h6>Monthly Average Rating</h6><canvas id="chartModalAvgRatingOverTime"></canvas></div> -->
                    <div class="col-md-6 stats-chart-container"><h6>Average Overall Rating by Genre</h6><canvas id="chartModalRatingByGenreRadar"></canvas></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Visual Data (Charts) -->

<!-- START CHUNK: Modal - Confirm Delete -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-md" role="document">
        <div class="modal-content fade-up">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Deletion</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
          </div>
          <div class="modal-body">
            <p id="deleteModalMessage">Are you sure you want to permanently delete this entry? This action cannot be undone.</p>
            <div id="batchDeleteOptions" style="display:none;">
                <p>Delete selected entries from:</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="deleteScope" id="deleteLocalOnly" value="local" checked>
                    <label class="form-check-label" for="deleteLocalOnly">Local Cache Only</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="deleteScope" id="deleteCloudOnly" value="cloud">
                    <label class="form-check-label" for="deleteCloudOnly">Cloud Only</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="deleteScope" id="deleteBoth" value="both">
                    <label class="form-check-label" for="deleteBoth">Both Local and Cloud</label>
                </div>
            </div>
          </div>
          <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button> <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button> </div>
        </div>
      </div>
    </div>
<!-- END CHUNK: Modal - Confirm Delete -->

<!-- START CHUNK: Modal - Confirm Duplicate Name -->
    <div class="modal fade" id="duplicateNameConfirmModal" tabindex="-1" role="dialog" aria-labelledby="duplicateNameConfirmModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content fade-up">
          <div class="modal-header bg-warning text-dark">
            <h5 class="modal-title" id="duplicateNameConfirmModalLabel">Duplicate Name Detected</h5>
            <button type="button" class="close text-dark" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
          </div>
          <div class="modal-body"> An entry with this name already exists. Do you want to save this new/edited entry with the same name?</div>
          <div class="modal-footer"> <button type="button" class="btn btn-secondary" id="cancelDuplicateSaveBtn" data-dismiss="modal">Cancel</button> <button type="button" class="btn btn-primary" id="confirmDuplicateSaveBtn">Save Anyway</button> </div>
        </div>
      </div>
    </div>
<!-- END CHUNK: Modal - Confirm Duplicate Name -->

<!-- START CHUNK: Modal - Confirm Erase Data -->
    <div class="modal fade" id="confirmEraseDataModal" tabindex="-1" role="dialog" aria-labelledby="confirmEraseDataModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document"> 
            <div class="modal-content fade-up">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="confirmEraseDataModalLabel">Confirm Erase Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body">
                    <p><strong>Warning:</strong> This action cannot be undone for the selected scope.</p>
                    <div class="form-group">
                        <label for="eraseDataScope">Choose what to erase:</label>
                        <select class="form-control" id="eraseDataScope">
                            <option value="local">Erase Local Device Cache Only</option>
                            <option value="cloud">Erase Cloud Account Data Only</option>
                            <option value="both">Erase From Both Local Cache and Cloud Account</option>
                        </select>
                    </div>
                    <p id="eraseScopeWarning" class="text-danger small"></p>
                    <p>Are you absolutely sure you want to proceed?</p>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-secondary" id="checkRepairDataBtn"><i class="fas fa-tools"></i> Check & Repair Data</button>
                    <div>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirmEraseDataBtn">Erase Selected Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Confirm Erase Data -->

<!-- START CHUNK: Modal - Batch Edit -->
    <div class="modal fade" id="batchEditModal" tabindex="-1" role="dialog" aria-labelledby="batchEditModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content fade-up">
                <div class="modal-header">
                    <h5 class="modal-title" id="batchEditModalLabel">Batch Edit Selected Entries</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body">
                    <form id="batchEditForm">
                        <p>Apply changes to <strong id="batchEditCount">0</strong> selected entries. <span class="text-info">Only checked fields will be updated.</span></p>
                        
                        <div class="form-group form-row align-items-center">
                            <div class="col-1"><input type="checkbox" id="batchEditApply_Status"></div>
                            <label for="batchEditStatus" class="col-3 col-form-label">Status</label>
                            <div class="col-8">
                                <select id="batchEditStatus" class="form-control form-control-sm">
                                    <option value="To Watch">To Watch</option>
                                    <option value="Watched">Watched</option>
                                    <option value="Continue">Continue</option>
                                    <option value="Unwatched">Unwatched</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group form-row align-items-center">
                            <div class="col-1"><input type="checkbox" id="batchEditApply_Category"></div>
                            <label for="batchEditCategory" class="col-3 col-form-label">Category</label>
                            <div class="col-8">
                                <select id="batchEditCategory" class="form-control form-control-sm">
                                    <option value="Movie">Movie</option>
                                    <option value="Series">Series</option>
                                    <option value="Documentary">Documentary</option>
                                    <option value="Special">Special</option>
                                </select>
                            </div>
                        </div>
                        
                        <hr>
                        <h6>Genre Actions</h6>
                        <div class="form-group form-row align-items-center">
                            <div class="col-1"><input type="checkbox" id="batchEditApply_AddGenre"></div>
                            <label for="batchEditAddGenre" class="col-3 col-form-label">Add Genre</label>
                            <div class="col-8">
                                <input type="text" class="form-control form-control-sm" id="batchEditAddGenre" placeholder="e.g. Comedy">
                            </div>
                        </div>
                        <div class="form-group form-row align-items-center">
                            <div class="col-1"><input type="checkbox" id="batchEditApply_RemoveGenre"></div>
                            <label for="batchEditRemoveGenre" class="col-3 col-form-label">Remove Genre</label>
                            <div class="col-8">
                                <input type="text" class="form-control form-control-sm" id="batchEditRemoveGenre" placeholder="e.g. Action">
                            </div>
                        </div>
                        <hr>
                        
                        <div class="form-group form-row align-items-center">
                            <div class="col-1"><input type="checkbox" id="batchEditApply_OverallRating"></div>
                            <label for="batchEditOverallRating" class="col-3 col-form-label">Overall Rating</label>
                            <div class="col-8">
                                <select id="batchEditOverallRating" class="form-control form-control-sm">
                                    <option value="">-- No Rating --</option>
                                    <option value="1">1 Star</option>
                                    <option value="2">2 Stars</option>
                                    <option value="3">3 Stars</option>
                                    <option value="4">4 Stars</option>
                                    <option value="5">5 Stars</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group form-row align-items-center">
                            <div class="col-1"><input type="checkbox" id="batchEditApply_Recommendation"></div>
                            <label for="batchEditRecommendation" class="col-3 col-form-label">My Recommendation</label>
                            <div class="col-8">
                                 <select id="batchEditRecommendation" class="form-control form-control-sm">
                                    <option value="">- No Change -</option>
                                    <option value="Ignore">Ignore</option>
                                    <option value="Less Recommended">Less Recommended</option>
                                    <option value="Recommended">Recommended</option>
                                    <option value="Highly Recommended">Highly Recommended</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group form-row align-items-center">
                            <div class="col-1"><input type="checkbox" id="batchEditApply_PersonalRecommendation"></div>
                            <label for="batchEditPersonalRecommendation" class="col-3 col-form-label">Watch Preference</label>
                            <div class="col-8">
                               <select id="batchEditPersonalRecommendation" class="form-control form-control-sm">
                                    <option value="">- No Change -</option>
                                    <option value="Watch Alone">watch alone</option>
                                    <option value="Safe to share">Safe to share</option>
                                </select>
                            </div>
                        </div>

                        <hr>
                        <div class="form-group form-row align-items-center">
                            <div class="col-1"><input type="checkbox" id="batchEditApply_Year"></div>
                            <label for="batchEditYear" class="col-3 col-form-label">Year of Release</label>
                            <div class="col-8">
                                <input type="number" class="form-control form-control-sm" id="batchEditYear" min="1888" max="2100" placeholder="e.g. 2023">
                            </div>
                        </div>
                        <div class="form-group form-row align-items-center">
                            <div class="col-1"><input type="checkbox" id="batchEditApply_Country"></div>
                            <label for="batchEditCountry" class="col-3 col-form-label">Country</label>
                            <div class="col-8">
                                <input type="text" class="form-control form-control-sm" id="batchEditCountry" placeholder="e.g. US, IN">
                            </div>
                        </div>
                         <div class="form-group form-row align-items-center">
                            <div class="col-1"><input type="checkbox" id="batchEditApply_Language"></div>
                            <label for="batchEditLanguage" class="col-3 col-form-label">Language</label>
                            <div class="col-8">
                                <input type="text" class="form-control form-control-sm" id="batchEditLanguage" placeholder="e.g., English, Hindi">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-save"></i> Apply Changes to Selected</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
<!-- END CHUNK: Modal - Batch Edit -->

<!-- START CHUNK: Toast Notification Component -->
      <div id="appToast" class="toast hide fade-up" role="alert" aria-live="assertive" aria-atomic="true" data-delay="3500">
        <div class="toast-header">
            <strong class="mr-auto" id="toastTitle">Notification</strong>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">×</span> </button>
        </div>
        <div class="toast-body" id="toastBody"> Message here. </div>
        <div id="toastActions" class="toast-footer p-2 text-right" style="border-top: 1px solid rgba(0,0,0,0.05);"></div>
      </div>
    </div>
<!-- END CHUNK: Toast Notification Component -->

<!-- START CHUNK: JavaScript Libraries and Application Logic Scripts -->
    <!-- Base libraries first -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- PDF Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.4/jspdf.plugin.autotable.min.js"></script>

   <!-- Custom JS modules  -->
    <script src="js/constant.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/indexeddb.js"></script>
    <script src="js/data.js"></script>
    <script src="js/io1.js"></script>
    <script src="js/io2.js"></script>
    <script src="js/tmdb.js"></script>
    <script src="js/genre.js"></script>
    <script src="js/analysis.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/reporting.js"></script>
    <script src="js/app.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/main.js"></script>
<!-- END CHUNK: JavaScript Libraries and Application Logic Scripts -->

</body>
</html>
