<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Genre Picker — demo</title>

  <!-- Bootstrap (for classes used in genre.js) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome for the plus icon used in genre.js -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

  <style>
    body { padding: 2rem; background:#f8f9fa; }
    .genre-input-wrapper { max-width:720px; margin:0 auto; }
    #genreInputContainer {
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      min-height:46px;
      padding:6px;
      border:1px solid #ced4da;
      border-radius:.375rem;
      background:#fff;
      cursor:text;
    }
    .genre-tag {
      display:inline-flex;
      align-items:center;
      background:#17a2b8;
      color:white;
      border-radius:999px;
      margin-right:.4rem;
      margin-bottom:.35rem;
      font-size:0.9rem;
    }
    .genre-tag .close {
      background:transparent;
      border:0;
      padding:0 .5rem;
      color:rgba(255,255,255,.95);
      cursor:pointer;
      font-size:1rem;
      line-height:1;
    }
    #genreSearchInput {
      min-width:160px;
      flex:1 1 160px;
      border:0;
      outline:0;
      padding:.25rem;
      font-size:0.95rem;
    }
    #genreDropdown { position:relative; }
    #genreItemsContainer {
      position:absolute;
      z-index:2000;
      top:6px;
      left:0;
      right:0;
      margin-top:.5rem;
      max-height:220px;
      overflow:auto;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
    }
    .dropdown-item.py-1 { padding-top:.35rem; padding-bottom:.35rem; }
  </style>
</head>
<body>

  <div class="genre-input-wrapper">
    <h3 class="mb-3">Genre picker (demo)</h3>

    <div id="genreInputContainer" aria-label="Selected genres and add control" tabindex="0">
      <input id="genreSearchInput" type="text"
             placeholder="Click to add genres..."
             aria-label="Search or add genres" />
    </div>

    <div id="genreDropdown" class="mt-2">
      <div id="genreItemsContainer" class="list-group bg-white border"></div>
    </div>

    <div class="text-muted small mt-2">
      Type to filter. Press Enter to add typed genre. Backspace removes last when input empty. Click a dropdown item to add.
    </div>
  </div>

  <script>
    const UNIQUE_ALL_GENRES = [
      "Action","Adventure","Animation","Biography","Comedy","Crime","Documentary","Drama",
      "Family","Fantasy","History","Horror","Music","Musical","Mystery","Romance",
      "Sci-Fi","Sport","Thriller","War","Western","Experimental","Short","Noir","Satire"
    ];
    var selectedGenres = [];
  </script>

  <script>
    function renderGenreTags() {
        const genreInputContainer = document.getElementById('genreInputContainer');
        if (!genreInputContainer) return;
        const searchInput = genreInputContainer.querySelector('#genreSearchInput');
        Array.from(genreInputContainer.children).forEach(child => {
            if (child !== searchInput) genreInputContainer.removeChild(child);
        });
        if (!Array.isArray(selectedGenres)) selectedGenres = [];
        selectedGenres.forEach(genre => {
            const tag = document.createElement('span');
            tag.className = 'genre-tag badge badge-info mr-1 mb-1 p-2';
            tag.textContent = genre;
            const closeBtn = document.createElement('button');
            closeBtn.type = 'button';
            closeBtn.className = 'close ml-2 text-white';
            closeBtn.innerHTML = '<span aria-hidden="true">×</span>';
            closeBtn.setAttribute('aria-label', `Remove genre ${genre}`);
            closeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                removeGenre(genre);
            });
            tag.appendChild(closeBtn);
            if (searchInput) {
                genreInputContainer.insertBefore(tag, searchInput);
            } else {
                genreInputContainer.appendChild(tag);
            }
        });
        if (searchInput) {
            searchInput.placeholder = selectedGenres.length === 0 ? "Click to add genres..." : "Search or add more...";
        }
    }

    function addGenre(genre) {
        if (!Array.isArray(selectedGenres)) selectedGenres = [];
        if (genre && typeof genre === 'string' && !selectedGenres.includes(genre)) {
            selectedGenres.push(genre);
            selectedGenres.sort();
            renderGenreTags();
        }
    }

    function removeGenre(genre) {
        if (!Array.isArray(selectedGenres)) selectedGenres = [];
        selectedGenres = selectedGenres.filter(g => g !== genre);
        renderGenreTags();
        const genreDropdownEl = document.getElementById('genreDropdown');
        if (genreDropdownEl && genreDropdownEl.style.display === 'block') {
            filterGenreDropdown();
        }
    }

    function populateGenreDropdown(filterText = "") {
        const genreItemsContainer = document.getElementById('genreItemsContainer');
        if (!genreItemsContainer) return;
        genreItemsContainer.innerHTML = '';
        const lowerFilterText = String(filterText || "").toLowerCase().trim();
        const availableGenres = UNIQUE_ALL_GENRES.filter(genre =>
            !selectedGenres.includes(genre) &&
            (lowerFilterText === "" || String(genre).toLowerCase().includes(lowerFilterText))
        ).sort();

        if (availableGenres.length === 0 && lowerFilterText) {
            const item = document.createElement('a');
            item.href = '#';
            item.className = 'list-group-item list-group-item-action dropdown-item py-1 text-success';
            item.innerHTML = `<i class="fas fa-plus-circle mr-2"></i> Add new genre: "${filterText}"`;
            item.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const newGenre = filterText.trim();
                addGenre(newGenre);
                const searchInputEl = document.getElementById('genreSearchInput');
                if (searchInputEl) {
                    searchInputEl.value = '';
                    searchInputEl.focus();
                }
                filterGenreDropdown();
            });
            genreItemsContainer.appendChild(item);
        } else if (availableGenres.length === 0) {
            const item = document.createElement('span');
            item.className = 'list-group-item text-muted small';
            item.textContent = 'All available genres are selected or no genres defined.';
            genreItemsContainer.appendChild(item);
        } else {
            availableGenres.forEach(genre => {
                const item = document.createElement('a');
                item.href = '#';
                item.className = 'list-group-item list-group-item-action dropdown-item py-1';
                item.textContent = genre;
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    addGenre(genre);
                    const searchInputEl = document.getElementById('genreSearchInput');
                    if (searchInputEl) {
                        searchInputEl.value = '';
                        searchInputEl.focus();
                    }
                    filterGenreDropdown();
                });
                genreItemsContainer.appendChild(item);
            });
        }
    }

    function filterGenreDropdown() {
        const searchInputEl = document.getElementById('genreSearchInput');
        if (searchInputEl) {
            populateGenreDropdown(searchInputEl.value);
        } else {
            populateGenreDropdown();
        }
    }

    (function wireUp() {
      const input = document.getElementById('genreSearchInput');
      const container = document.getElementById('genreInputContainer');
      const dropdown = document.getElementById('genreDropdown');
      const items = document.getElementById('genreItemsContainer');
      if (!input || !container || !dropdown || !items) return;

      container.addEventListener('click', () => {
        input.focus();
        dropdown.style.display = 'block';
        filterGenreDropdown();
      });

      document.addEventListener('click', (e) => {
        if (!container.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.style.display = 'none';
        }
      });

      input.addEventListener('input', () => {
        filterGenreDropdown();
        dropdown.style.display = 'block';
      });

      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          const val = input.value.trim();
          if (!val) return;
          const lower = val.toLowerCase();
          const match = UNIQUE_ALL_GENRES.find(g => g.toLowerCase() === lower);
          if (match) addGenre(match);
          else addGenre(val);
          input.value = '';
          filterGenreDropdown();
          dropdown.style.display = 'block';
        } else if (e.key === 'Backspace' && input.value === '') {
          if (selectedGenres && selectedGenres.length > 0) {
            const last = selectedGenres[selectedGenres.length - 1];
            removeGenre(last);
            filterGenreDropdown();
          }
        } else if (e.key === 'ArrowDown') {
          const first = items.querySelector('a.list-group-item');
          if (first) first.focus();
        }
      });

      items.addEventListener('keydown', (e) => {
        if (e.target.matches('a.list-group-item')) {
          if (e.key === 'ArrowDown') {
            e.preventDefault();
            const next = e.target.nextElementSibling;
            if (next && next.matches('a.list-group-item')) next.focus();
          } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            const prev = e.target.previousElementSibling;
            if (prev && prev.matches('a.list-group-item')) prev.focus();
            else input.focus();
          }
        }
      });

      renderGenreTags();
      populateGenreDropdown();
    })();
  </script>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>