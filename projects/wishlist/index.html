<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wishlist</title>
    <meta name="description" content="A powerful, offline-first wishlist and goal planning application.">

    <!-- PWA and Mobile Theming -->
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1e1e1e" media="(prefers-color-scheme: dark)">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css?v=1.0">
</head>
<body>
    <header class="top-nav">
        <button id="theme-toggle" class="icon-btn" aria-label="Toggle theme">
            <i class="fa-solid fa-circle-half-stroke"></i>
        </button>
        
        <div class="total-price">
            <span>Total:</span>
            <span id="total-price-display">Rs 0.00</span>
        </div>

        <button id="settings-btn" class="icon-btn" aria-label="Open settings">
            <i class="fa-solid fa-bars"></i>
        </button>
    </header>
    <main class="main-content">
        <h2 id="profile-name-header" style="margin-bottom: 1.5rem; color: var(--text-secondary);">Loading...</h2>
        <div id="toast" class="toast"></div>

        <div class="filter-controls">
            <input type="search" id="search-input" class="form-control" placeholder="Search wishes..." style="min-width: 150px;">
            <div style="display: flex; gap: 1rem; flex-grow:1;">
                <select id="sort-select" class="form-control" style="flex-grow:1;">
                    <option value="createdAt-desc">Recently Added</option>
                    <option value="price-asc">Price: Low to High</option>
                    <option value="price-desc">Price: High to Low</option>
                    <option value="name-asc">Name (A-Z)</option>
                    <option value="goalDate-asc">Goal Date</option>
                </select>
                <button id="view-toggle-btn" class="icon-btn" aria-label="Toggle view">
                    <i class="fa-solid fa-grip"></i>
                </button>
            </div>
        </div>
        <div id="tag-filter-container" class="tag-filter-container"></div>
        <div id="wishlist-container" class="grid-view"></div>
        <div id="empty-state-message" class="empty-state"></div>
    </main>

    <nav class="bottom-nav">
        <button id="completed-btn" class="icon-btn" aria-label="View completed wishes">
            <i class="fa-solid fa-clipboard-check"></i>
        </button>
        <button id="add-wish-btn" class="fab" aria-label="Add a new item">
            <i class="fa-solid fa-plus"></i>
        </button>
        <button id="profile-btn" class="icon-btn" aria-label="Switch profile">
            <i class="fa-solid fa-users"></i>
        </button>
    </nav>

    <!-- Add/Edit Modal -->
    <dialog id="add-edit-modal">
        <form id="add-edit-form" novalidate>
            <header class="modal-header">
                <h2 id="modal-title" class="modal-title">Add Wish</h2>
                <button type="button" class="icon-btn" data-close-modal aria-label="Close dialog">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </header>
            <div class="modal-body">
                <input type="hidden" id="edit-item-id">
                <div class="form-group">
                    <label for="productName">Product Name</label>
                    <input type="text" id="productName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="imageUpload">Image</label>
                    <input type="file" id="imageUpload" class="form-control-file" accept="image/*">
                    <label for="imageUpload" class="file-input-label btn btn-secondary">
                        <i class="fa-solid fa-upload"></i>
                        Choose Image
                    </label>
                    <img id="image-preview" src="" alt="Image Preview" class="image-preview">
                </div>
                <div class="form-group">
                    <label for="goalDate">My Goal (Date)</label>
                    <input type="date" id="goalDate" class="form-control">
                </div>
                <div class="form-group">
                    <label for="tags">Tags (comma separated)</label>
                    <input type="text" id="tags" class="form-control" placeholder="e.g. electronics, birthday, home">
                </div>
                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Prices</label>
                    <div id="prices-container">
                    </div>
                    <button type="button" id="add-price-btn" class="btn btn-secondary">
                        <i class="fa-solid fa-plus"></i>
                        Add Price
                    </button>
                </div>
                <div class="form-group">
                    <label>Store Links</label>
                    <div id="links-container"></div>
                    <button type="button" id="add-link-btn" class="btn btn-secondary">
                        <i class="fa-solid fa-plus"></i>
                        Add Link
                    </button>
                </div>
            </div>
            <footer class="modal-footer">
                <button type="button" class="btn btn-secondary" data-close-modal>Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </footer>
        </form>
    </dialog>

    <!-- Other Modals -->
    <dialog id="completed-modal">
        <header class="modal-header">
            <h2 class="modal-title">Completed Wishes</h2>
            <button type="button" class="icon-btn" data-close-modal aria-label="Close dialog">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </header>
        <div class="modal-body">
            <div id="completed-list-container"></div>
        </div>
    </dialog>

    <dialog id="settings-modal">
        <header class="modal-header">
            <h2 class="modal-title">Settings & Info</h2>
            <button type="button" class="icon-btn" data-close-modal aria-label="Close dialog">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </header>
        <div class="modal-body">
            <h4>About Us</h4>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                A powerful, offline-first wishlist and goal planning application.
            </p>
            <h4>Analytics</h4>
            <button id="analytics-btn" class="btn btn-secondary">
                <i class="fa-solid fa-chart-pie"></i> 
                View Wishlist Stats
            </button>
            <h4>Contact</h4>
            <div style="font-size: 1.5rem; display: flex; gap: 1rem;">
                <a href="https://github.com/Nishant7Adhikari" target="_blank" class="icon-btn">
                    <i class="fa-brands fa-github"></i>
                </a>
                <a href="https://x.com/Nishant_OP11" target="_blank" class="icon-btn">
                    <i class="fa-brands fa-twitter"></i>
                </a>
                <a href="mailto:iam@nishantadhikari.info.np" class="icon-btn">
                    <i class="fa-solid fa-envelope"></i>
                </a>
            </div>
        </div>
    </dialog>

    <dialog id="profile-modal">
        <header class="modal-header">
            <h2 class="modal-title">Switch Profile</h2>
            <button type="button" class="icon-btn" data-close-modal aria-label="Close dialog">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </header>
        <div class="modal-body">
            <div id="profile-list" class="profile-list">
            </div>
            <hr class="divider">
            <h4>Add New Profile</h4>
            <form id="add-profile-form" class="add-profile-form">
                <input type="text" id="new-profile-name" class="form-control" placeholder="Profile Name" required>
                <button type="submit" class="btn btn-primary">Add</button>
            </form>
        </div>
    </dialog>

    <dialog id="link-choice-modal">
        <header class="modal-header">
            <h2 class="modal-title">Choose a Link</h2>
            <button type="button" class="icon-btn" data-close-modal aria-label="Close dialog">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </header>
        <div class="modal-body">
            <ul id="link-choice-list" class="link-list"></ul>
        </div>
    </dialog>
    <dialog id="notes-modal">
        <header class="modal-header">
            <h2 class="modal-title">Notes</h2>
            <button type="button" class="icon-btn" data-close-modal aria-label="Close dialog">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </header>
        <div class="modal-body">
            <p id="notes-content"></p>
        </div>
    </dialog>
    <dialog id="analytics-modal">
        <header class="modal-header">
            <h2 class="modal-title">Wishlist Analytics</h2>
            <button type="button" class="icon-btn" data-close-modal aria-label="Close dialog">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </header>
        <div class="modal-body">
            <div id="analytics-grid" class="analytics-grid"></div>
        </div>
    </dialog>
    
    <script src="script.js" defer></script>
</body>
</html>